name: AI Dashboard Auto Update
on:
  workflow_dispatch: {}
jobs:
  update:
    runs-on: ubuntu-latest
    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install deps
        run: npm ci
      - name: Run News Agent
        run: node scripts/agent_conversation.mjs
      - name: Guard news_current.json
        run: bash -lc "test -s public/data/news_current.json && node -e \"const fs=require('fs');const a=JSON.parse(fs.readFileSync('public/data/news_current.json','utf8'));if(!Array.isArray(a)||a.length===0)process.exit(1)\""
      - name: Guard snapshots
        run: bash -lc "test -s public/data/news_snapshots.json"
